<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel - SpeedyDelivery</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f8f8f8; }
    h2 { color: #ff6600; }
    input, textarea {
      display: block;
      margin: 10px 0;
      padding: 10px;
      width: 300px;
      max-width: 90%;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    button {
      background-color: #ff6600;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 5px;
      cursor: pointer;
    }
    .log {
      margin-top: 30px;
      border-top: 1px solid #ddd;
      padding-top: 15px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .history-card {
      background: #fff;
      border-left: 5px solid #ff6600;
      padding: 10px;
      margin: 8px 0;
      border-radius: 5px;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
    }
    .history-info {
      max-width: 80%;
    }
    .history-time {
      font-size: 0.85em;
      color: #555;
      margin-top: 3px;
    }
    .history-location {
      font-size: 0.85em;
      color: #0077cc;
      margin-top: 3px;
    }
    .delete-btn {
      background: #e63946;
      border: none;
      color: white;
      border-radius: 5px;
      cursor: pointer;
      padding: 5px 8px;
      font-size: 0.8em;
    }
  </style>
</head>
<body>
  <script>
    // Simple password protection
    const password = prompt("Enter Admin Password:");
    if (password !== "1234") { 
      alert("Access Denied!");
      window.location.href = "index.html"; 
    }
  </script>

  <h2>Admin - Update Tracking</h2>

  <input type="text" id="tracking-id" placeholder="Tracking ID">
  <textarea id="tracking-status" rows="2" placeholder="Enter new status"></textarea>
  <input type="text" id="tracking-location" placeholder="Enter last known location">
  <input type="datetime-local" id="tracking-time">
  <button onclick="addUpdate()">Add Update</button>

  <div class="log">
    <h3>Current Data</h3>
    <div id="current-data"></div>
  </div>

  <script>
    function loadData() {
      const data = JSON.parse(localStorage.getItem("trackingData")) || {};
      const container = document.getElementById("current-data");
      container.innerHTML = "";

      for (const id in data) {
        const updates = data[id];
        const section = document.createElement("div");
        section.innerHTML = `<h4>${id}</h4>`;
        updates.sort((a, b) => new Date(a.time) - new Date(b.time));

        updates.forEach((update, index) => {
          const card = document.createElement("div");
          card.classList.add("history-card");

          const infoDiv = document.createElement("div");
          infoDiv.classList.add("history-info");

          const status = document.createElement("div");
          status.textContent = `üìç ${update.status}`;
          infoDiv.appendChild(status);

          if (update.location) {
            const loc = document.createElement("div");
            loc.classList.add("history-location");
            loc.textContent = `üìå Location: ${update.location}`;
            infoDiv.appendChild(loc);
          }

          const time = document.createElement("div");
          time.classList.add("history-time");
          time.textContent = new Date(update.time).toLocaleString();
          infoDiv.appendChild(time);

          // delete button
          const delBtn = document.createElement("button");
          delBtn.classList.add("delete-btn");
          delBtn.textContent = "Delete";
          delBtn.onclick = function() {
            if (confirm("Are you sure you want to delete this update?")) {
              deleteUpdate(id, index);
            }
          };

          card.appendChild(infoDiv);
          card.appendChild(delBtn);
          section.appendChild(card);
        });

        container.appendChild(section);
      }
    }

    function addUpdate() {
      const id = document.getElementById("tracking-id").value.trim();
      const status = document.getElementById("tracking-status").value.trim();
      const location = document.getElementById("tracking-location").value.trim();
      const time = document.getElementById("tracking-time").value;

      if (!id || !status || !time) {
        alert("Fill Tracking ID, Status, and Time!");
        return;
      }

      let data = JSON.parse(localStorage.getItem("trackingData")) || {};
      if (!data[id]) data[id] = [];

      data[id].push({ status, location, time });
      localStorage.setItem("trackingData", JSON.stringify(data));

      loadData();
      alert("‚úÖ Update Added!");
    }

    function deleteUpdate(id, index) {
      let data = JSON.parse(localStorage.getItem("trackingData")) || {};
      data[id].splice(index, 1); // remove that update

      // If no updates left for this tracking ID, remove the whole key
      if (data[id].length === 0) {
        delete data[id];
      }

      localStorage.setItem("trackingData", JSON.stringify(data));
      loadData();
    }

    loadData();
  </script>
</body>
</html>